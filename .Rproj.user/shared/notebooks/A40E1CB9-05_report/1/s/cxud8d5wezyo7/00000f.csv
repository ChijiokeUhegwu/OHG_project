"0","# Instead of plotting the raw year counts, it is best to normalize the data by number of isolates per year to account for the difference in the sampling difference by year."
"0",""
"0","resfinder_fulldata %>%"
"0","  "
"0","  # Step 0: Collapse years first"
"0","  mutate("
"0","    collection_year = ifelse("
"0","      collection_year %in% c(2021, 2022),"
"0","      ""2021-2022"","
"0","      as.character(collection_year)"
"0","    )"
"0","  ) %>%"
"0","  "
"0","  # Step 1: Count unique isolates per year per drug class"
"0","  distinct(sample_id, collection_year, drug_class_group) %>%"
"0","  count(collection_year, drug_class_group, name = ""class_count"") %>%"
"0","  "
"0","  # Step 2: Compute total isolates per (collapsed) year"
"0","  left_join("
"0","    resfinder_fulldata %>%"
"0","      mutate("
"0","        collection_year = ifelse("
"0","          collection_year %in% c(2021, 2022),"
"0","          ""2021-2022"","
"0","          as.character(collection_year)"
"0","        )"
"0","      ) %>%"
"0","      distinct(sample_id, collection_year) %>%"
"0","      count(collection_year, name = ""total_isolates""),"
"0","    by = ""collection_year"""
"0","  ) %>%"
"0","  "
"0","  # Step 3: Compute proportion"
"0","  mutate(prop = class_count / total_isolates) %>%"
"0","  "
"0","  # Step 4: Plot"
"0","  ggplot(aes(x = collection_year, y = prop, color = drug_class_group)) +"
"0","  geom_line(size = 1) +"
"0","  geom_point(size = 2) +"
"0","  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +"
"0","  scale_color_viridis_d(option = ""D"") +"
"0","  labs("
"0","    x = ""Year of collection"","
"0","    y = ""Percentage of isolates"","
"0","    color = ""Drug class group"","
"0","    title = ""Figure 8: Temporal trends in antimicrobial resistance classes"""
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme("
"0","    panel.grid = element_blank(),"
"0","    plot.title = element_text(size = 12, face = ""bold"", hjust = 0.2)"
"0","  )"
"0",""
